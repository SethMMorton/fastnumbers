language: python
os: linux
dist: xenial

python:
  - 3.5
  - 3.6
  - 3.7
  - 3.8

env:
  - CC=clang
  - CC=gcc CFLAGS="--coverage -O0"

jobs:
  include:
    # Windows tests!
    - {env: PYTHON_VERSION=3.5.4, os: windows, language: sh}
    - {env: PYTHON_VERSION=3.6.8, os: windows, language: sh}
    - {env: PYTHON_VERSION=3.7.4, os: windows, language: sh}
    - {env: PYTHON_VERSION=3.8.0, os: windows, language: sh}

before_install:
- bash dev/ci-prepare-environment.bash

install:
- source dev/ci-update-path.bash
- python -m pip install -U pip
- python -m pip install codecov
- python -m pip install -r dev/requirements.txt

before_script:
- source dev/ci-update-path.bash
- python dev/patch_doctest.py

script:
- source dev/ci-update-path.bash
- python setup.py install
- python -m doctest fastnumbers
- pytest --doctest-glob=README.rst

after_success:
- (test "$CC" == "gcc" && codecov --gcov-args '-o build/temp.*/src') || echo "skipping coverage!"

cache:
  - pip
  - directories:
    - $HOME/.pyenv_cache
    - /c/Python35
    - /c/Python36
    - /c/Python37
    - /c/Python38
